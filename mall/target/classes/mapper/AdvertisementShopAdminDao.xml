<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mall.dao.AdvertisementShopAdminDao">
	
	<resultMap type="com.example.mall.entity.AdvertisementShop" id="AdShop">
		<id property="advertisementShopId" column="advertisement_shop_id" />
		<result property="headUrl" column="head_url" />
		<result property="shopId" column="shop_id" />
		<result property="shopUrl" column="shop_url" />
		<result property="enableStatus" column="enable_status" />
		<result property="createTime" column="create_time" />
		<result property="lastEditTime" column="last_edit_time" />
		<result property="price" column="price" />
		
		<association property="shop" javaType="com.example.mall.entity.Shop">
            <id property="shopId" column="shop_id" />
            <result property="shopName" column="shop_name" />
            <result property="userName" column="user_name" />
            <result property="shopEmail" column="shop_email" />            
        </association>     
	</resultMap>
	
	<select id="querySuccessfulApplicationShop" resultMap="AdShop" parameterType="java.util.Date">
		SELECT *
		FROM tb_advertisement_shop
		WHERE create_time <![CDATA[ >= ]]> #{start} and create_time <![CDATA[ <= ]]> #{end} and enable_status = 1
	</select>
	
	<update id="refuseAdvertisementShop">
		UPDATE tb_advertisement_shop
		SET enable_status = -1
		where advertisement_shop_id = #{advertisementShopId}
	</update>

	<update id="agreeAdvertisementShop">
		UPDATE tb_advertisement_shop
		SET enable_status = 1
		where advertisement_shop_id = #{advertisementShopId}
	</update>

	<select id="queryAllAdvertisementShop" resultMap="AdShop">
		SELECT *
		FROM tb_advertisement_shop as ad,tb_shop as shop
		WHERE ad.create_time > #{time} and ad.enable_status = 0 and ad.shop_id = shop.shop_id
		ORDER BY price DESC
	</select>
	
	<select id="queryAllAgreeAdvertisementShop" resultType="com.example.mall.entity.AdvertisementShop">
		SELECT advertisement_shop_id,shop_id,shop_name,head_url,shop_url,price,create_time,last_edit_time
		FROM tb_advertisement_shop
		WHERE create_time > #{time} and enable_status = 1 
	</select>
</mapper>